# Amazon GuardDuty Malware Protection for Amazon S3

This example uses .

## Build

To build this app, you need to be in the root cdk folder. Then run the following:

```bash
npm install -g aws-cdk
npm ci
npm run build
```

This will install the necessary CDK, then this example's dependencies, and then build your TypeScript files and your CloudFormation template.

## Bootstrap AWS Account

This stack uses assets, so the toolkit stack must be deployed to the environment. This can be done by running the following command:

```shell script
cdk bootstrap aws://account-id/aws-region
```

## Components

This CDK app has components:

- GuardDuty Malware Protection (GuardDutyS3Stack)
- An S3 Protection Bucket (S3MalwareProtectedBucket)
- An S3 Clean Bucket (S3MalwareCleanBucket)
- Lambda Copy Function (S3MalwareCleanBucket)
- EventBridge Rule for S3 Tag (S3MalwareCleanBucket)

## Deploy ALL

To deploy / redeploy the Stack to your AWS Account, run

```shell script
npm run install
```

After the deployment you will see source Bucket and a Protection Plan for S3 in the GuardDuty Console.

## Deploy Minimal Resources

To deploy ONLY the Source Bucket and the GuardDuty Malware Protection Plan, run

```shell script
npm run install-minimum
```

### Customise the Resource Names

To deploy the solution with custom bucketnames you can pass key values to the install

```shell script
npm run install scanbucketname cleanbucket
```

After the deployment you will see source Bucket and a Protection Plan for S3 in the GuardDuty Console.

## Synthesize Cloudformation Template

To see the Cloudformation template generated by the CDK, run `cdk synth`, then check the output file in the "cdk.out" directory.

## Delete / Cleanup

To cleanup the solution

```shell script
npm run destroy
```
